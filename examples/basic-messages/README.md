# Basic C-to-Haxe Message Passing

Example demonstrating embedding a multi-threaded haxe program in a simple C program. The haxe code embedded is [HaxeProgram.hx](./HaxeProgram.hx) and the hosting C program is [main.c](./main.c)

[main.c](./main.c) Uses the HaxeEmbed library to start a haxe thread and pass it messages. When the haxe thread starts, the haxe `main()` function in [HaxeProgram.hx](./HaxeProgram.hx) is executed and it registers a callback to receive messages from native code using `HaxeEmbed.setMessageHandler(onMessage)`

[main.c](./main.c) demonstrates many common patterns you may want to use â€“ synchronous and asynchronous message passing, supplying callbacks to the haxe code so it can call into native code and restarting the haxe thread

## Compiling

I've included a makefile for compiling on macOS (`make -f makefile.mac`), however the example is simple and should work with any C toolchain or platform, to compile from scratch:

**Requirements**:
- haxe 4.2
- hxcpp 4.2.*

**Steps**:
- Install hxcpp dependency: `haxelib install build-library.hxml` (this will install hxcpp to [.haxelib/](.haxelib/))
- Compile the haxe code into a dynamic library: `haxe build-library.hxml`, this will generate a shared library in **haxe-bin/** ready for embedding in a native application
- Compile [main.c](./main.c) with your favorite C compiler and link it to the shared library generated by hxcpp

	For macOS this is
	```bash
	# copy shared library so it will be found by the executable
	cp haxe-bin/HaxeProgram-debug.dylib .
	# compile main.c to 'main` executable and link with shared library
	clang main.c -o main haxe-bin/HaxeProgram-debug.dylib
	```

	For linux this might be something like
	```bash
	# copy shared library so it will be found by the executable
	cp haxe-bin/HaxeProgram-debug.so .
	# compile main.c to 'main` executable and link with shared library
	gcc main.c -o main haxe-bin/HaxeProgram-debug.so
	```